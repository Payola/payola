@(user: Option[cz.payola.domain.entities.User], analysis: cz.payola.domain.entities.Analysis)

@renderInstance(inst: cz.payola.domain.entities.plugins.PluginInstance, analysis: cz.payola.domain.entities.Analysis) = {

<div style="float: left; min-width:300px;" class="successors">
    @analysis.pluginInstanceBindings.filter(p => p.targetPluginInstance == inst).map{ b =>
        @renderInstance(inst = b.sourcePluginInstance, analysis)
    }
    <hr style="clear: both; height: 0px; visibility: hidden;" />
    <div class="alert alert-info instance" id="inst_@inst.id">
        <h3>@inst.plugin.name</h3>
        @inst.plugin.parameters.map{param =>
            <p><strong>@param.name</strong>: @inst.getParameter(param.name)</p>
        }
    </div>

</div>
}

@main(user, "Analysis "+analysis.name+" :: Payola!") {

<div class="container-fluid">

    <ul class="breadcrumb">
        <li>
            <a href="/">Home</a> <span class="divider">/</span>
        </li>
        <li class="active">Analysis: @analysis.name</li>
    </ul>

    <h1>Detail of analysis: @analysis.name <a href="@routes.Analysis.edit(analysis.id)" class="btn btn-small" style="margin-bottom: 5px; margin-left: 10px;"><i class="icon-pencil"></i> Edit</a>
    </h1>

    <div class="row-fluid" id="client-canvas">


    </div>
</div><!--/.fluid-container-->

<script>
    var settings = {
        PaintStyle:{ lineWidth:2, strokeStyle:"#BCE8F1", outlineColor:"#3A87AD", outlineWidth:1 },
        Connector:[ "Flowchart", { stub: 1 } ],
        Endpoint:[ "Dot", { radius:4 } ],
        EndpointStyle : { fillStyle: "#3A87AD"  },
        Anchor : [ "TopCenter", "BottomCenter" ]
    };

    @analysis.pluginInstanceBindings.map{ b =>
        var instance = jsPlumb.getInstance(settings);
        instance.connect({ source:"inst_@b.sourcePluginInstance.id", target:"inst_@b.targetPluginInstance.id", scope:"someScope" });
    }
</script>

<script src="/javaScriptPackage/cz.payola.web.client.presenters.AnalysisRunner" type="text/javascript"></script>
<script type="text/javascript">
    new cz.payola.web.client.presenters.AnalysisRunner("client-canvas", "@analysis.id").initialize();
</script>

}
